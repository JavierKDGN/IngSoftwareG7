{% extends "base.html" %}

{% block title %}Reservar Cita{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Reservar Cita Médica</h1>

    <!-- Selección de Especialidad -->
    <form method="POST" action="{{ url_for('reservar_cita') }}">
    <!-- Selección de Especialidad -->
    <div class="mb-3">
        <label for="especialidad" class="form-label">Seleccionar Especialidad</label>
        <select class="form-select" name="especialidad" id="especialidad" required>
            <option value="" selected disabled>Seleccione una especialidad</option>
            {% for especialidad in especialidades %}
            <option value="{{ especialidad }}">{{ especialidad }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Selección de Médico -->
    <div class="mb-3">
        <label for="medico" class="form-label">Seleccionar Médico</label>
        <select class="form-select" name="medico" id="medico" required>
            <option value="" selected disabled>Seleccione un médico</option>
        </select>
    </div>

    <!-- Botón Reservar -->
    <div class="text-center">
        <button type="submit" class="btn btn-primary">Reservar Cita</button>
    </div>
</form>

<script>
    document.getElementById('especialidad').addEventListener('change', function () {
        const especialidad = this.value;

        // Realiza una solicitud POST para obtener los médicos
        fetch('{{ url_for("get_medicos") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ especialidad: especialidad }),
        })
        .then(response => response.json())
        .then(data => {
            const medicoSelect = document.getElementById('medico');
            medicoSelect.innerHTML = '<option value="" selected disabled>Seleccione un médico</option>'; // Limpiar opciones
            if (data.medicos) {
                data.medicos.forEach(medico => {
                    const option = document.createElement('option');
                    option.value = medico.id_medico;
                    option.textContent = medico.nombre;
                    medicoSelect.appendChild(option);
                });
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>
</div>
{% endblock %}
